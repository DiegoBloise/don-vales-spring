<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template/template.xhtml">

	<ui:define name="head">
		<h:outputScript name="layout.js" library="js"/>
	</ui:define>

    <ui:define name="content">

		<h:form>

			<div class="crud-demo">
				<p:toolbar rendered="#{userSession.usuario.isAdmin()}" styleClass="mt-3">

					<p:toolbarGroup>

						<!-- <p:commandButton value="Vale" type="button" icon="pi pi-external-link"
							onclick="PF('dlgVale').show()" styleClass="mr-2"/> -->

						<p:commandButton value="Acerto" icon="pi pi-search" actionListener="#{acertoView.novoAcerto}" process="@this" styleClass="mr-2"/>

					</p:toolbarGroup>

				</p:toolbar>

				<p:dataTable id="dt-entregadores" widgetVar="dtEntregadores" var="entregador" value="#{acertoView.entregadoresDt}"
									reflow="true" styleClass="my-3" rowKey="#{entregador.id}" rows="15" scrollRows="20"
									scrollable="true" liveScroll="true" scrollHeight="550" stripedRows="true">

					<f:facet name="header">
						<div class="products-table-header">
							<span style="font-weight: bold">Entregadores</span>
							<span class="filter-container ui-input-icon-left"> <i class="pi pi-search"></i>
								<p:inputText id="globalFilter" onkeyup="PF('dtEntregadores').filter()" placeholder="Buscar"/>
							</span>
						</div>
					</f:facet>

					<p:column headerText="Entregador" sortBy="#{entregador.nome}" filterBy="#{entregador.nome}">
						<h:outputLabel value="#{entregador.nome}" />
					</p:column>

				</p:dataTable>

			</div>

		</h:form>

		<h:form id="dialogs">

			<p:dialog id="acertoDialog" header="Acerto" widgetVar="acertoDialog" dynamic="true" showEffect="fade"
				modal="true" blockScroll="true" draggable="false" resizable="false" fitViewport="true" responsive="true"
				closable="false" closeOnEscape="false">

				<h:panelGroup id="manage-acerto-content" styleClass="relative z-0 flex flex-column fadein animation-duration-300 gap-4 m-2 max-w-min" style="height: 550px; width: 560px;">

					<h:panelGroup class="flex flex-column gap-2">

						<h:panelGroup styleClass="flex flex-row gap-2 align-items-end justify-content-center ui-fluid" id="pngAcerto">

							<div class="flex flex-column flex-grow-1">
								<p:outputLabel value="Data Inicio:" for="dtInicio" />
								<p:datePicker id="dtInicio" value="#{acertoView.dataInicio}" required="true" showIcon="true" showOnFocus="disable"/>
							</div>

							<div class="flex flex-column flex-grow-1">
								<p:outputLabel value="Data Fim:" for="dtFim" />
								<p:datePicker id="dtFim" value="#{acertoView.dataFim}"	required="true" showIcon="true" showOnFocus="disable"/>
							</div>

							<div class="flex flex-column flex-grow-1">
								<p:commandButton styleClass="w-15rem" value="Buscar Entregadores" actionListener="#{acertoView.buscarEntregadoresAcerto}"
									update="@root:@id(pngAcerto2)" icon="pi pi-search" process="@this pngAcerto"/>
							</div>

						</h:panelGroup>

						<h:panelGroup styleClass="flex flex-row gap-2 justify-content-center align-items-end ui-fluid" id="pngAcerto2">

							<div class="flex flex-column flex-grow-1">

								<p:outputLabel for="@next" value="Entregador" />
								<p:selectOneMenu disabled="#{empty acertoView.entregadores}" autoWidth="true" id="acertoSomEntregadores" required="true"
									value="#{acertoView.entregadorSelecionado}" converter="#{entregadorConverter}">
									<f:selectItem itemLabel="Selecione" itemValue="" noSelectionOption="true"/>
									<f:selectItems value="#{acertoView.entregadores}" var="entregador" itemLabel="#{entregador.nome}" itemValue="#{entregador}" />
								</p:selectOneMenu>

							</div>

							<div class="flex flex-column">
								<p:commandButton disabled="#{empty acertoView.entregadores}" styleClass="w-15rem" value="Calcular Total" actionListener="#{acertoView.realizarAcerto}"
									update="@root:@id(pngAcerto3) @root:@id(acertoList) @root:@id(vale-dialog-footer)" icon="pi pi-dollar" process="@this @root:@id(pngAcerto2)"/>
							</div>

						</h:panelGroup>

					</h:panelGroup>

					<h:panelGroup class="flex flex-row justify-content-center p-3 border-300 border-1 border-round min-w-max" id="pngAcerto3">

						<h:panelGroup rendered="#{empty acertoView.entregadorSelecionado.valorTotalComDesconto}" styleClass="flex flex-column mx-6 gap-2 justify-content-center">
							<p:skeleton width="12rem" class="mb-2"/>
							<p:skeleton width="8rem" class="mb-2"/>
							<p:skeleton width="7rem" class="mb-2"/>
							<p:skeleton width="12rem" class="mt-5"/>
						</h:panelGroup>

						<h:panelGroup rendered="#{not empty acertoView.entregadorSelecionado.valorTotalComDesconto}" styleClass="flex flex-column mx-6 gap-2 justify-content-center">

							<div class="flex flex-row gap-3 justify-content-between">
								<h:outputText styleClass="font-semibold" value="Colaborador:" />
								<h:outputText value="#{acertoView.entregadorSelecionado.nome}" />
							</div>

							<div class="flex flex-row gap-3 justify-content-between">
								<h:outputText styleClass="font-semibold" value="Qtde de DiÃ¡rias:" />
								<h:outputText value="#{acertoView.entregadorSelecionado.qtdTotalDias}" />
							</div>

							<div class="flex flex-row gap-3 justify-content-between">
								<h:outputText styleClass="font-semibold" value="Total de entregas:" />
								<h:outputText value="#{acertoView.entregadorSelecionado.qtdEntregas}" />
							</div>

							<div class="flex flex-row gap-3 justify-content-between mt-5">
								<h:outputText styleClass="font-semibold" value="Total Receber:" />
								<h:outputText value="#{acertoView.entregadorSelecionado.valorTotalComDesconto}">
									<f:convertNumber type="currency" currencySymbol="R$" />
								</h:outputText>
							</div>

						</h:panelGroup>

						<p:divider layout="vertical"/>

						<p:skeleton rendered="#{empty acertoView.entregadorSelecionado.valorTotalComDesconto}" width="10rem" height="10rem" styleClass="mx-6"/>
						<p:barcode rendered="#{not empty acertoView.entregadorSelecionado.valorTotalComDesconto}" styleClass="mx-6" type="qr" value="#{acertoView.entregadorSelecionado.gerarPayloadPix()}" width="125" height="125"/>

					</h:panelGroup>

					<p:dataTable id="acertoList" var="acerto" value="#{acertoView.acertos}" style="font-size:12px; min-width: 400;">

						<p:column headerText="Data da Entrega">
							<p:outputLabel value="#{acerto.dataFormatada}" />
						</p:column>

						<p:column headerText="Qtde Entregas">
							<p:outputLabel value="#{acerto.qtdeEntregasDia}" />
						</p:column>

						<p:column headerText="Valor DiÃ¡ria">
							<h:outputText value="#{acerto.valorDiaria}">
								<f:convertNumber type="currency" currencySymbol="R$" />
							</h:outputText>
						</p:column>

						<p:column headerText="Qtde de IFood">
							<p:outputLabel value="#{acerto.qtdeIFood}" />
						</p:column>

						<p:column>
							<p:outputLabel value="" />
						</p:column>
						<p:column headerText="Valor Vale">
							<h:outputText value="#{acerto.valorValeDia}">
								<f:convertNumber type="currency" currencySymbol="R$" />
							</h:outputText>
						</p:column>

						<p:columnGroup type="footer">

							<p:row>

								<p:column colspan="1" style="text-align:right"
									footerText="Totais:" />

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{acertoView.entregadorSelecionado.valorTotalEntregas}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{acertoView.entregadorSelecionado.valorTotalDiarias}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{acertoView.entregadorSelecionado.valorTotalIfood}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{acertoView.entregadorSelecionado.valorTotalSemDesconto}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column style="color:red">
									<f:facet name="footer">
										<h:outputText value="#{acertoView.entregadorSelecionado.valorTotalVales}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

							</p:row>

							<p:row>

								<p:column colspan="5" style="text-align:right" footerText="Saldo:" />

								<p:column style="color: red">
									<f:facet name="footer">
										<h:outputText value="#{acertoView.entregadorSelecionado.valorSaldo}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

							</p:row>

							<p:row>

								<p:column colspan="5" style="text-align:right"
									footerText="Receber:" />

								<p:column style="color: green">

									<f:facet name="footer">
										<h:outputText value="#{acertoView.entregadorSelecionado.valorTotalComDesconto}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>

								</p:column>

							</p:row>

						</p:columnGroup>

					</p:dataTable>

				</h:panelGroup>

				<f:facet name="footer">

					<h:panelGroup id="vale-dialog-footer">
						<p:commandButton disabled="#{empty acertoView.textoVale}" value="Enviar Mensagem" icon="pi pi-whatsapp" process="@this" actionListener="#{acertoView.sendValeToWhatsapp}" styleClass="ui-button-success"/>

						<p:commandButton disabled="#{empty acertoView.textoVale}" value="Copiar Recibo" icon="pi pi-copy" process="@this" actionListener="#{acertoView.copyValeToClipboard}"/>

						<p:commandButton value="Cancelar" process="@this" actionListener="#{acertoView.cancelar}"
										icon="pi pi-times" styleClass="ui-button-secondary" update="@root:@id(manage-acerto-content) @root:@id(vale-dialog-footer)" oncomplete="PF('acertoDialog').hide()"/>
					</h:panelGroup>

				</f:facet>

			</p:dialog>

			<p:dialog id="zapDialog" widgetVar="zapDialog" header="ZipZop" minHeight="40" width="350" showEffect="fade" dynamic="true" modal="true" responsive="true">
				<p:graphicImage id="qrcodezap" value="/resources/qrcodes/qrcode.png" />
			</p:dialog>

		</h:form>

	</ui:define>

</ui:composition>