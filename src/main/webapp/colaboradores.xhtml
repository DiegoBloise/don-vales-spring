<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">

	<h:head>
		<meta charset="UTF-8" />
		<h:outputScript name="layout.js" library="js" />
	</h:head>

	<h:body>

		<h:form id="principal">

			<p:growl id="msgs" showDetail="true" skipDetailIfEqualsSummary="true" />

			<p:card>
				<p:dataTable id="colaboradores" var="colaborador" value="#{gestaoColaboradorView.colaboradores}"
							widgetVar="customersTable" multiViewState="true" selectionMode="single"
							selection="#{gestaoColaboradorView.colaboradorSelecionado}"
							rowKey="#{colaborador.id}"
							emptyMessage="Sem colaboradores cadastrados">

					<p:ajax event="rowSelect" update="@root:@id(manage-product-content)" oncomplete="PF('dlgColaborador').show()"/>

					<p:column style="width:2rem">
						<p:rowToggler/>
					</p:column>

					<p:column headerText="Name" filterBy="#{colaborador.nome}" sortBy="#{colaborador.nome}"
							filterMatchMode="contains">
						<h:outputText value="#{colaborador.nome}"/>
					</p:column>

					<p:column headerText="Tipo Colaborador" filterBy="#{colaborador.tipoColaborador}" sortBy="#{colaborador.tipoColaborador}"
							filterMatchMode="exact">
						<f:facet name="filter">
							<p:selectOneMenu onchange="PF('customersTable').filter()"
											style="width:100%; box-sizing: border-box;">
								<f:selectItem itemLabel="Selecione" itemValue="#{null}" noSelectionOption="true"/>
								<f:selectItems value="#{gestaoColaboradorView.tipoColaborador}"/>
							</p:selectOneMenu>
						</f:facet>
						<span>#{colaborador.tipoColaborador}</span>
					</p:column>

					<p:rowExpansion>

						<p:dataTable id="vales" var="vale" value="#{gestaoColaboradorView.valesDoColaborador(colaborador)}" lazy="true">

							<p:column headerText="Colaborador">
								<p:outputLabel value="#{vale.entregador}" />
							</p:column>

							<p:column headerText="Data do Vale">
								<p:outputLabel value="#{vale.dataFormatada}" />
							</p:column>

							<p:column headerText="Tipo">
								<p:outputLabel value="#{vale.tipoVale}" />
							</p:column>

							<p:column headerText="Valor">
								<h:outputText value="#{vale.valor}">
									<f:convertNumber type="currency" currencySymbol="R$" />
								</h:outputText>
							</p:column>

							<!-- <p:column exportable="false">
								<p:commandButton class="ui-button-warning rounded-button"
									icon="pi pi-trash" process="@this"
									oncomplete="PF('deleteValeDialog').show()">
									<f:setPropertyActionListener value="#{vale}"
										target="#{gestaoColaboradorView.valeSelecionado}" />
								</p:commandButton>
							</p:column> -->

							<p:columnGroup type="footer">

								<p:row>
									<p:column colspan="3" style="text-align:right" footerText="Total:" />

									<p:column style="color: red">
										<f:facet name="footer">
											<h:outputText value="#{gestaoColaboradorView.totalDoColaborador(colaborador)}">
												<f:convertNumber type="currency" currencySymbol="R$" />
											</h:outputText>
										</f:facet>
									</p:column>
								</p:row>

							</p:columnGroup>

						</p:dataTable>

					</p:rowExpansion>

				</p:dataTable>

			</p:card>

		</h:form>

		<h:form id="dialogs">

			<p:dialog header="Vales" widgetVar="dlgColaborador"
						showEffect="fade"
						modal="true" 
						blockScroll="false"
						id="dialog">

				<p:outputPanel id="manage-product-content">
					<h:panelGrid columns="2">
						<p:outputLabel for="@next" value="Nome: "/>
						<p:outputLabel value="#{gestaoColaboradorView.colaboradorSelecionado.nome}"/>

						<p:outputLabel for="@next" value="Data do Vale:"/>
						<p:datePicker id="navigator" value="#{gestaoColaboradorView.vale.data}"
							pattern="dd/MM/yyyy" mask="true" required="true"/>

						<p:outputLabel for="@next" value="Valor:"/>
						<p:inputNumber value="#{gestaoColaboradorView.valorVale}" decimalPlaces="2" 
							thousandSeparator="." decimalSeparator="," placeholder="0,00" required="true"/>

						<p:outputLabel for="@next" value="Tipo de Vale:" />
						<p:selectOneMenu id="valeTipo" value="#{gestaoColaboradorView.vale.tipoVale}"
							effect="fold" required="true">
							<f:selectItem itemLabel="Selecione:" itemValue="" />
							<f:selectItems value="#{entregaView.tipoVale}" />
						</p:selectOneMenu>

					</h:panelGrid>
				</p:outputPanel>

				<f:facet name="footer">
					<p:commandButton value="Salvar" icon="pi pi-check"
						actionListener="#{gestaoColaboradorView.salvarVale}"
						update="@root:@id(vales)"
						oncomplete="PF('imprimeValeDialog').show(); PF('dlgColaborador').hide();"/>

					<p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dlgColaborador').hide()"
						class="ui-button-secondary" type="button" />
				</f:facet>

			</p:dialog>


			<p:confirmDialog widgetVar="imprimeValeDialog" showEffect="fade" width="300"
				message="Imprimir Vale?" header="Confirmação" severity="warn">
				<p:commandButton value="Sim" icon="pi pi-check" actionListener="#{gestaoColaboradorView.download}"
								process="@this"
								update="principal"
								oncomplete="PF('imprimeValeDialog').hide()">
					<p:fileDownload value="#{gestaoColaboradorView.file}"/>
				</p:commandButton>

				<p:commandButton value="Não" type="button" styleClass="ui-button-secondary" icon="pi pi-times"
								onclick="PF('imprimeValeDialog').hide()" />
			</p:confirmDialog>


			<p:confirmDialog global="true" showEffect="fade" width="300">
				<p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
				<p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"
					icon="pi pi-times" />
			</p:confirmDialog>


		</h:form>

	</h:body>

</html>