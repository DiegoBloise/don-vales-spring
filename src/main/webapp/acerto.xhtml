<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template/template.xhtml">

	<ui:define name="head">
		<h:outputScript name="layout.js" library="js"/>
	</ui:define>

    <ui:define name="content">

		<h:form>
			<p:commandButton value="Vale" type="button" icon="pi pi-external-link"
				onclick="PF('dlgVale').show()" />

			<p:commandButton value="Acerto" type="button" icon="pi pi-search"
				onclick="PF('acertoDialog').show()" />

		</h:form>

		<h:form id="dialogs">

			<p:dialog id="acertoDialog" header="Acerto" widgetVar="acertoDialog" showEffect="fade" hideEffect="fade" dynamic="true"
				modal="true" blockScroll="false" resizable="false" fitViewport="true" responsive="true" closable="false" closeOnEscape="false">

				<h:panelGroup id="manage-acerto-content" class="flex flex-column gap-4 m-2 max-w-min" style="min-width: 550px;">

					<h:panelGroup class="flex flex-column gap-2">

						<h:panelGroup styleClass="flex flex-row gap-2 align-items-end justify-content-center ui-fluid" id="pngAcerto">

							<div class="flex flex-column flex-grow-1">
								<p:outputLabel value="Data Inicio:" for="dtInicio" />
								<p:datePicker id="dtInicio" value="#{entregaView.dataInicio}" required="true" showIcon="true" showOnFocus="disable"/>
							</div>

							<div class="flex flex-column flex-grow-1">
								<p:outputLabel value="Data Fim:" for="dtFim" />
								<p:datePicker id="dtFim" value="#{entregaView.dataFim}"	required="true" showIcon="true" showOnFocus="disable"/>
							</div>

							<div class="flex flex-column flex-grow-1">
								<p:commandButton styleClass="w-15rem" value="Buscar Entregadores" action="#{entregaView.buscarEntregadoresAcerto}"
									update="@root:@id(messages) @root:@id(manage-acerto-content)" icon="pi pi-search" process="@this pngAcerto"/>
							</div>

						</h:panelGroup>

						<h:panelGroup styleClass="flex flex-row gap-2 justify-content-center align-items-end ui-fluid" id="pngAcerto2">

							<div class="flex flex-column flex-grow-1">
								<p:outputLabel for="@next" value="Entregador" />
								<p:selectOneMenu id="acertoSomEntregadores" required="true"
									value="#{entregaView.entregadorSelecionado}">
									<f:selectItem itemLabel="Selecione" itemValue="" />
									<f:selectItems value="#{entregaView.entregadores}" />
								</p:selectOneMenu>
							</div>

							<div class="flex flex-column">
								<p:commandButton styleClass="w-15rem" value="Calcular Total" action="#{entregaView.realizarAcerto}"
									update="@root:@id(messages) @root:@id(manage-acerto-content)" icon="pi pi-dollar" process="@this @root:@id(pngAcerto2)"/>
							</div>

						</h:panelGroup>

					</h:panelGroup>

					<h:panelGroup class="flex flex-row justify-content-center p-3 border-300 border-1 border-round min-w-max" id="pngAcerto3">

						<h:panelGroup rendered="#{empty entregaView.qrpix}" styleClass="flex flex-column mx-6 gap-2 justify-content-center">
							<p:skeleton width="12rem" class="mb-2"/>
							<p:skeleton width="8rem" class="mb-2"/>
							<p:skeleton width="7rem" class="mb-2"/>
							<p:skeleton width="12rem" class="mt-5"/>
						</h:panelGroup>

						<h:panelGroup rendered="#{not empty entregaView.qrpix}" styleClass="flex flex-column mx-6 gap-2 justify-content-center">

							<div class="flex flex-row gap-3 justify-content-between">
								<h:outputText styleClass="font-semibold" value="Entregador:" />
								<h:outputText value="#{entregaView.entregadorSelecionado}" />
							</div>

							<div class="flex flex-row gap-3 justify-content-between">
								<h:outputText styleClass="font-semibold" value="Qtde de Diárias:" />
								<h:outputText value="#{entregaView.qtdeTotalDias}" />
							</div>

							<div class="flex flex-row gap-3 justify-content-between">
								<h:outputText styleClass="font-semibold" value="Total de entregas:" />
								<h:outputText value="#{entregaView.qtdeEntregas}" />
							</div>

							<div class="flex flex-row gap-3 justify-content-between mt-5">
								<h:outputText styleClass="font-semibold" value="Total Receber:" />
								<h:outputText value="#{entregaView.valorTotalComDesconto}">
									<f:convertNumber type="currency" currencySymbol="R$" />
								</h:outputText>
							</div>

						</h:panelGroup>

						<p:divider layout="vertical"/>

						<p:skeleton rendered="#{empty entregaView.qrpix}" width="10rem" height="10rem" styleClass="mx-6"/>
						<p:barcode rendered="#{not empty entregaView.qrpix}" styleClass="mx-6" type="qr" value="#{entregaView.qrpix}" width="125" height="125"/>

					</h:panelGroup>


					<p:dataTable id="acertoList" var="acerto"
						value="#{entregaView.acertos}" style="font-size:12px; min-width: 400;">

						<p:column headerText="Data da Entrega">
							<p:outputLabel value="#{acerto.dataFormatada}" />
						</p:column>

						<p:column headerText="Qtde Entregas">
							<p:outputLabel value="#{acerto.qtdeEntregasDia}" />
						</p:column>

						<p:column headerText="Valor Diária">
							<h:outputText value="#{acerto.valorDiaria}">
								<f:convertNumber type="currency" currencySymbol="R$" />
							</h:outputText>
						</p:column>

						<p:column headerText="Qtde de IFood">
							<p:outputLabel value="#{acerto.qtdeIFood}" />
						</p:column>

						<p:column>
							<p:outputLabel value="" />
						</p:column>
						<p:column headerText="Valor Vale">
							<h:outputText value="#{acerto.valorValeDia}">
								<f:convertNumber type="currency" currencySymbol="R$" />
							</h:outputText>
						</p:column>

						<p:columnGroup type="footer">

							<p:row>

								<p:column colspan="1" style="text-align:right"
									footerText="Totais:" />

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{entregaView.valorTotalEntregas}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{entregaView.valorTotalDiarias}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{entregaView.valorTotalIfood}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column>
									<f:facet name="footer">
										<h:outputText value="#{entregaView.valorTotalSemDesconto}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

								<p:column style="color:red">
									<f:facet name="footer">
										<h:outputText value="#{entregaView.valorTotalVales}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

							</p:row>

							<p:row>

								<p:column colspan="5" style="text-align:right" footerText="Saldo:" />

								<p:column style="color: red">
									<f:facet name="footer">
										<h:outputText value="#{entregaView.valorSaldo}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>
								</p:column>

							</p:row>

							<p:row>

								<p:column colspan="5" style="text-align:right"
									footerText="Receber:" />

								<p:column style="color: green">

									<f:facet name="footer">
										<h:outputText value="#{entregaView.valorTotalComDesconto}">
											<f:convertNumber type="currency" currencySymbol="R$" />
										</h:outputText>
									</f:facet>

								</p:column>

							</p:row>

						</p:columnGroup>

					</p:dataTable>

				</h:panelGroup>

				<f:facet name="footer">
                    <p:commandButton value="Salvar" icon="pi pi-check" update="@root:@id(manage-acerto-content)" partialSubmit="true"/>

                    <p:commandButton value="Cancelar" update="@root:@id(acertoDialog)" process="@this" actionListener="#{entregaView.cancelar}"
                                    icon="pi pi-times" styleClass="ui-button-secondary" oncomplete="PF('acertoDialog').hide()"/>
                </f:facet>

			</p:dialog>


			<p:dialog header="Vale" widgetVar="dlgVale" showEffect="fade"
				id="dlgVale" modal="true" width="1100" height="500">

				<h:panelGrid id="pngVales">

					<h:panelGrid columns="2">

						<p:outputLabel value="Data do Vale" />
						<p:datePicker id="dtVale" value="#{entregaView.dataSelecionada}"
							required="true">
							<p:ajax event="dateSelect" listener="#{entregaView.onDateSelect}"
								update="valeSomEntregadores" />
						</p:datePicker>

					</h:panelGrid>

					<h:panelGrid columns="3">

						<p:outputLabel for="@next" value="Entregador" />
						<p:selectOneMenu id="valeSomEntregadores"
							value="#{entregaView.vale.entregador}" required="true">
							<f:selectItem itemLabel="Selecione" itemValue="" />
							<f:selectItems value="#{entregaView.entregadores}" />
						</p:selectOneMenu>

						<p:commandButton action="#{entregaView.buscarVales}"
							update="@root:@id(messages) valeList valeSomEntregadores" icon="pi pi-search" process="valeSomEntregadores @this"/>

					</h:panelGrid>

					<h:panelGrid columns="2">
						<p:outputLabel for="@next" value="Valor" />
						<p:inputNumber value="#{entregaView.valorVale}" decimalPlaces="2"
							thousandSeparator="." decimalSeparator="," placeholder="0,00" required="true"/>


						<p:outputLabel for="@next" value="Tipo de Vale" />
						<p:selectOneMenu id="valeTipo" value="#{entregaView.vale.tipoVale}" required="true">
							<f:selectItem itemLabel="Selecione" itemValue="" />
							<f:selectItems value="#{entregaView.tipoVale}" />
						</p:selectOneMenu>

					</h:panelGrid>

					<p:commandButton value="Salvar" action="#{entregaView.salvarVale}"
						update="@root:@id(messages) pngVales valeList" />

				</h:panelGrid>

				<p:dataTable id="valeList" var="vale" value="#{entregaView.vales}">

					<p:column headerText="Data do Vale">
						<p:outputLabel value="#{vale.dataFormatada}" />
					</p:column>

					<p:column headerText="Entregador">
						<p:outputLabel value="#{vale.entregador}" />
					</p:column>

					<p:column headerText="Valor">
						<h:outputText value="#{vale.valor}">
							<f:convertNumber type="currency" currencySymbol="R$" />
						</h:outputText>
					</p:column>

					<p:column headerText="Tipo">
						<p:outputLabel value="#{vale.tipoVale}" />
					</p:column>

					<p:column exportable="false">

						<p:commandButton class="ui-button-warning rounded-button"
							icon="pi pi-trash" process="@this"
							oncomplete="PF('deleteProductDialog').show()">
							<f:setPropertyActionListener value="#{vale}"
								target="#{entregaView.valeSelecionado}" />
						</p:commandButton>
					</p:column>

				</p:dataTable>

				<p:confirmDialog widgetVar="deleteProductDialog" width="300"
					message="Apagar o vale?" header="Confirmação" severity="warn"
					appendTo="@(body)">
					<p:commandButton value="Sim" icon="pi pi-check"
						action="#{entregaView.apagarVale}" process="@this"
						oncomplete="PF('deleteProductDialog').hide()" update="valeList" />
					<p:commandButton value="Não" type="button"
						styleClass="ui-button-secondary" icon="pi pi-times"
						onclick="PF('deleteProductDialog').hide()" />
				</p:confirmDialog>

			</p:dialog>

		</h:form>

	</ui:define>

</ui:composition>